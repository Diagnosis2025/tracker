/* Basic layout */
* { box-sizing: border-box; }
body, html { margin: 0; height: 100%; font-family: system-ui, Arial, sans-serif; color: #0f172a; }
.hidden { display: none !important; }

.topbar {
  height: 58px; display: flex; align-items: center; justify-content: space-between;
  padding: 0 12px; background:#111827; color:#fff; gap:10px;
}
.topbar .brand { font-weight:700; }
.topbar .toolbar { display:flex; gap:8px; align-items:center; flex-wrap: wrap; }
.units strong { font-size: 16px; }

.btn { padding: 6px 10px; border:1px solid #e5e7eb; background:#fff; border-radius:8px; cursor:pointer; }
.btn:hover { background:#f3f4f6; }
.btn-primary { background:#2563eb; color:#fff; border-color:#2563eb; }
.btn-primary:hover { background:#1d4ed8; }
.btn-secondary { background:#0ea5e9; color:#fff; border-color:#0ea5e9; }
.btn-secondary:hover{ background:#0284c7; }
.btn-danger { background:#ef4444; color:#fff; border-color:#ef4444; }
.btn-sm { padding: 4px 8px; }
.mt { margin-top: 12px; }
.mt-s { margin-top: 6px; }

.pane { height: calc(100vh - 58px); }
#mapPane { position: relative; }
#map { position: absolute; inset: 0; }

.card { background:#fff; border-radius:12px; padding:16px; border:1px solid #e5e7eb; }
.auth-card { max-width: 720px; margin: 24px auto; }
.grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.grid4 { display:grid; grid-template-columns: repeat(4,1fr); gap: 10px; }
input { width: 100%; padding: 8px 10px; border-radius: 8px; border:1px solid #cbd5e1; }
.debug { background:#0f172a; color:#d1d5db; padding: 8px; border-radius:8px; min-height: 80px; overflow:auto; }

.side-modal {
  position: absolute; top: 70px; left: 10px; width: 320px;
  background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow: 0 10px 30px rgba(0,0,0,.15);
  z-index: 400; padding: 8px 10px;
}
.side-modal header { display:flex; align-items:center; justify-content:space-between; }
.side-modal .content { padding: 8px 4px; }

/* Right details panel */
.details-panel {
  position: absolute; top: 10px; right: 10px; width: 460px;
  background:#fff; border:5px solid #e5e7eb; border-radius:12px; box-shadow: 0 10px 30px rgba(0,0,0,.15);
  z-index: 450; display:flex; flex-direction: column;
}
.details-header { display:flex; align-items:center; justify-content: space-between; padding: 12px; border-bottom:1px solid #e5e7eb; }
.details-header .big { font-size: 20px; font-weight: 700; }
.muted { color:#6b7280; }
.details-body { padding: 12px; display:grid; gap: 6px; }
.kv { display:flex; justify-content: space-between; border-bottom:1px dashed #e5e7eb; padding: 4px 0; }
.kv .k { color:#6b7280; }
.details-actions { padding: 12px; border-top:1px solid #e5e7eb; display:grid; gap:12px; }
.group-title { font-weight:600; margin-bottom: 26px; }
.chips { display:flex; flex-wrap: wrap; gap:6px; }
.chip { border:1px solid #d1d5db; padding:6px 8px; border-radius:999px; cursor:pointer; background:#fff; }
.chip:hover { background:#f3f4f6; }

.toast {
  position: fixed; left: 50%; transform: translateX(-50%);
  bottom: 16px; background:#111827; color:#fff; padding: 10px 14px; border-radius: 8px;
  z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,.25);
}

.route-popup {
  font-size: 12px;
  line-height: 1.4;
}

.route-popup strong {
  display: inline-block;
  width: 80px;
}

/* Agregar en tu CSS */
.route-popup {
  font-size: 12px;
  line-height: 1.4;
}

.route-popup strong {
  display: inline-block;
  width: 80px;
}

/* Estilos para las flechas y banderas */
.leaflet-marker-icon {
  filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.5));
}

/* Panel de estado (derecha, compacto) */
.status-panel{
  position: absolute;
  top: 10px; right: 10px; width: 320px;
  background:#fff; border:1px solid #e5e7eb; border-radius:12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.15);
  z-index: 440; /* debajo de details-panel (450) */
  display: flex; flex-direction: column;
}
.status-panel header { padding: 12px; border-bottom:1px solid #e5e7eb; }
.status-panel .big { font-size: 18px; font-weight:700; }

.status-panel .stats { padding: 10px 12px; display: grid; gap: 8px; }
.status-panel .row {
  display:flex; align-items:center; justify-content:space-between;
  padding: 8px 10px; border:1px solid #e5e7eb; border-radius:10px;
}
.status-panel .row-btn {
  cursor:pointer; background:#fff;
}
.status-panel .row-btn:hover { background:#f9fafb; }
.status-panel .label { display:flex; align-items:center; gap: 8px; color:#111827; }
.status-panel .value { font-weight: 700; }
.status-panel .icon { width: 18px; height: 18px; }


:root{
  --topbar-h: 70px;            /* si tu AppBar mide ~70px */
  --sidebar-w: 280px;          /* ancho expandida */
  --sidebar-w-collapsed: 48px; /* ancho minimizada */
}

/* Dejá espacio para la barra lateral fija */
#mapPane{
  position: relative;
  padding-left: var(--sidebar-w);
}

/* Ajuste cuando está minimizada */
body.sidebar-collapsed #mapPane{
  padding-left: var(--sidebar-w-collapsed);
}

/* ==== LEFT SIDEBAR FIJA ==== */
.left-sidebar{
  position: fixed;
  top: var(--topbar-h);
  bottom: 0;
  left: 0;
  width: var(--sidebar-w);
  background: #121826;           /* oscuro lindo */
  color: #fff;
  border-right: 1px solid #223047;
  z-index: 1000;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* Botón de minimizar/expandir (pega al borde derecho) */
.left-sidebar .collapse-handle{
  position: absolute;
  top: 8px;
  right: 12px;
  width: 24px;
  height: 54px;
  border-radius: 12px;
  border: 10px solid #223047;
  background: #0f172a;
  color: #fff;
  font-size: 22px;
  cursor: pointer;
  line-height: 22px;
  text-align: center;
  box-shadow: 0 0 0 3px rgba(15,23,42,.2);
}
.left-sidebar.collapsed .collapse-handle{
  right: -12px;
}
/* Cambiamos la flecha cuando está colapsada */
.left-sidebar:not(.collapsed) .collapse-handle::after{ content:""; }
.left-sidebar.collapsed .collapse-handle{ transform: rotate(180deg); }

/* Encabezado */
.left-sidebar .sp-header{
  padding: 14px 14px 8px 14px;
  border-bottom: 1px solid #223047;
}
.sp-title{
  font-size: 12px;
  color: #9aa6b2;
  text-transform: uppercase;
  letter-spacing: .06em;
}
.sp-user{
  font-size: 16px;
  font-weight: 700;
  margin-top: 4px;
}

/* Cuerpo */
.left-sidebar .sp-body{
  padding: 10px 8px 10px 8px;
  overflow-y: auto;
}
.sp-section-title{
  font-size: 12px;
  color: #9aa6b2;
  text-transform: uppercase;
  letter-spacing: .06em;
  margin: 36px 36px 10px;
}

.sp-row{
  display:flex;
  align-items:center;
  gap:10px;
  padding: 10px 8px;
  border-radius: 8px;
  margin: 6px;
  background: #0f172a;
  border: 1px solid #223047;
}
.sp-row .sp-icon{ width: 18px; text-align: center; }
.sp-row .sp-label{ flex: 1; font-weight: 600; }
.sp-row .sp-value{ font-weight: 800; }

.sp-row.clickable{ cursor: pointer; }
.sp-row.clickable:hover{ background:#111c34; }

/* Estado COLAPSADO: sólo dejamos ver el botón y un margen */
.left-sidebar.collapsed{
  width: var(--sidebar-w-collapsed);
}
.left-sidebar.collapsed .sp-header,
.left-sidebar.collapsed .sp-body{
  display: none;
}

/* (opcional) Ensanchar un poquito tu panel de detalles de la derecha */
.details-panel{
  width: 420px; /* antes era más angosto */
}


/* Paneles del lado derecho (Buscar, Mi flota y Detalles) */
.right-drawer,
.details-panel{
  position: fixed;
  top: var(--topbar-h);
  right: 0;
  bottom: 0;
  width: 420px;              /* un poco más ancho como pediste */
  background: #ffffff;
  border-left: 1px solid #e5e7eb;
  box-shadow: -8px 0 24px rgba(0,0,0,.08);
  z-index: 1001;             /* por encima del mapa, debajo de toasts si tenés */
  display: flex;
  flex-direction: column;
}

.right-drawer header,
.details-panel .details-header{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 12px 14px;
  border-bottom: 1px solid #e5e7eb;
  background: #f8fafc;
}

.right-drawer .content,
.details-panel .details-actions,
.details-panel .details-body{
  padding: 14px;
  overflow: auto;
}

/* Flechas de dirección (divIcon con <img>) */
.leaflet-marker-icon.arrow-icon {
  background: transparent;
  border: 0;
  pointer-events: none; /* no tapa la polyline ni los puntos */
}
.arrow-icon img {
  width: 20px;
  height: 20px;
  display: block;
}

.menu-wrapper { position: relative; display: inline-block; }
.dropdown.hidden { display: none; }
.dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  min-width: 140px;

  border-radius: 8px;
  box-shadow: 0 10px 24px rgba(0,0,0,.12);
  padding: 6px;
  z-index: 2000;
}
.dropdown .btn {
  display: block;
  width: 100%;
  text-align: left;
  margin: 4px 0;
}
.btn-ghost { background: transparent; }

/* caret en el botón */
#btnMenu::after {
  content: "▾";       /* también podés usar "▼" o "⌄" */
  display: inline-block;
  margin-left: 8px;
  transition: transform 0.2s ease;
}

/* cuando el dropdown está abierto, giramos el caret */
.dropdown.open #btnMenu::after {
  transform: rotate(180deg);
}


/* Si ya tenías estilos para .details-panel, podés dejarlos;
   esto asegura que Buscar/Mi flota usen el mismo layout a la derecha */


   /* Estilos para el menú desplegable */
/* Estilos para el menú desplegable */
.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  position: absolute;                 /* en PC, relativo al botón */
  top: 100%;                          /* justo debajo del botón */
  left: 0;                            /* alineado a la izquierda del botón */
  right: auto;
  min-width: 200px;
  max-height: calc(100vh - var(--topbar-h, 60px) - 12px);
  overflow: auto;
  z-index: 3000;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  cursor: pointer;
}

.dropdown-content a:hover {
  background-color: #f1f1f1;
}

/* Asegurar que el botón Menú tenga el mismo estilo que otros botones */
#btnMenu {
  padding: 6px 10px;
  border: 1px solid #e5e7eb;
  background: #fff;
  border-radius: 8px;
  cursor: pointer;
}

#btnMenu:hover {
  background: #f3f4f6;
}

.leaflet-bottom.leaflet-right {
  bottom: 20px;
  right: 10px;
}
  
  .leaflet-control-zoom {
    border: 2px solid rgba(0, 0, 0, 0.2);
    border-radius: 4px;
    margin-bottom: 20px !important;
  }
  
  .leaflet-control-zoom a {
  background-color: #fff;
  color: #333;
  border-bottom: 1px solid #ccc;
  width: 30px;
  height: 30px;
  line-height: 30px;
  font-size: 18px;
  font-weight: bold;
}

.leaflet-control-zoom a:first-child {
  border-radius: 4px 4px 0 0;
}

.leaflet-control-zoom a:last-child {
  border-bottom: none;
  border-radius: 0 0 4px 4px;
}

.leaflet-control-zoom a:hover {
  background-color: #f4f4f4;
}

.marker-label {
  background-color: rgba(255, 255, 255, 0.9);
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 2px 6px;
  font-size: 12px;
  font-weight: bold;
  text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.8);
  white-space: nowrap;
}

.leaflet-tooltip-bottom:before {
  border-bottom-color: rgba(255, 255, 255, 0.9);
}

/* ===== NUEVOS ESTILOS PARA ESPACIADO ===== */
/* Ajustar espaciado en el panel de detalles */
.details-actions .group {
  margin-bottom: 20px; /* Aumentar espacio entre grupos */
}

.details-actions .group:last-child {
  margin-bottom: 0; /* Quitar margen del último grupo */
}

.details-actions .group-title {
  font-weight: 600;
  margin-bottom: 12px; /* Aumentar espacio debajo del título */
  font-size: 14px;
  color: #374151;
}

/* Espaciado específico para el grupo de chips */
.details-actions .chips {
  margin-bottom: 8px; /* Espacio debajo de los chips */
}

/* Espaciado para los inputs de fecha */
.details-actions .grid2 {
  gap: 12px; /* Más espacio entre los inputs de fecha */
  margin-bottom: 12px; /* Espacio debajo de los inputs */
}

/* Espaciado para el botón de buscar */
.details-actions #btnApplyRange {
  margin-bottom: 6px; /* Espacio debajo del botón buscar */
}

/* Espaciado para el botón de descargar */
.details-actions #btnDownload {
  margin-top: 8px; /* Espacio arriba del botón descargar */
}

.app-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #111827;
    color: white;
    padding: 10px 20px;
    text-align: center;
    font-size: 14px;
    z-index: 1000;
    border-top: 1px solid #374151;
  }

  .app-footer a {
    color: #60a5fa;
    text-decoration: none;
  }

  .app-footer a:hover {
    text-decoration: underline;
  }

  /* Ocultar footer en el mapa */
  #mapPane ~ .app-footer {
    display: none;
  }

  /* Ajustar el auth-container para el footer */
  .auth-container {
    min-height: calc(100vh - 40px); /* Considerar altura del footer */
    padding-bottom: 50px; /* Espacio extra para que no quede tapado */
  }


  /* Iconitos en claves del panel de detalles */
  .kv .k {
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .kv .k .ico {
    font-size: 16px;
    line-height: 1;
    width: 16px;
    display: inline-flex;
    justify-content: center;
  }

  /* Botón */
.refs-btn {
  margin-left: 12px;
  padding: 6px 10px;
  border: 1px solid #e2e8f0;
  background: #fff;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
}

/* Wrapper ancla (en la toolbar) */
.refs-wrap { position: relative; }

/* Dropdown alineado arriba a la derecha del botón */
.refs-dropdown {
  position: fixed !important;         /* <- no depender de la toolbar */
  top: var(--topbar-h, 60px);
  right: 12px;
  left: 12px;                         /* que pueda ocupar ancho si hace falta */
  max-width: min(100vw - 24px, 420px);/* opcional: limitá ancho en desktop */
  max-height: calc(100vh - var(--topbar-h, 60px) - 12px);
  overflow: auto;
  z-index: 3000;
  border-radius: 8px;
}

@media (min-width: 1025px) {
  /* Dropdown alineado arriba a la derecha del botón SOLO en PC */
  .refs-dropdown {
    position: absolute !important;     /* <- posición relativa al botón */
    top: 100%;                        /* justo debajo del botón */
    right: 0;                         /* alineado a la derecha del botón */
    left: auto !important;            /* anula cualquier left anterior */
    width: 420px;                     /* ancho fijo en PC */
    max-width: none;                  /* quita limitación de ancho */
    max-height: 70vh;                 /* altura máxima */
    overflow: auto;
    z-index: 3000;
    border-radius: 8px;
    margin-top: 8px;                  /* separación del botón */
    transform: none !important;       /* anula cualquier transform */
  }
}

/* contenido */
.refs-header { font-weight: 600; padding: 10px 14px; border-bottom: 1px solid #f0f0f0; color: #374151; }
.refs-item   { display: flex; align-items: center; gap: 10px; padding: 10px 14px; }
.refs-item:hover { background: #f9fafb; }
.refs-item img { width: 36px; height: 36px; flex: 0 0 28px; }
.refs-text { display: flex; flex-direction: column; line-height: 1.2; }
.refs-title { font-size: 16px; color: #111827; }
.refs-path  { font-size: 14px; color: #6b7280; }

/* Fondo sólido y sombra para Referencias y Menú */
.refs-dropdown,
.dropdown-content {
  background: #ffffff;                 /* ← fondo blanco */
  border: 1px solid #e5e7eb;           /* borde suave */
  box-shadow: 0 12px 30px rgba(0,0,0,.12), 0 2px 10px rgba(0,0,0,.08);
}

/* Ajustes de padding internos (opcional) */
.refs-dropdown {
  padding: 8px 0;
}

@media (max-width: 1024px) {
  .refs-dropdown,
  .dropdown-content {
    position: fixed !important;
    top: var(--topbar-h, 68px); /* Usar la nueva altura */
    right: 0;
    left: 0;
    width: 100vw;
    max-height: calc(100vh - var(--topbar-h, 68px) - 12px);
    border-radius: 0;
    border-left: none;
    border-right: none;
  }
}

/* ===== ACTUALIZAR VARIABLES CSS ===== */
:root{
  --topbar-h: 68px; /* Actualizar con la nueva altura */
  --sidebar-w: 280px;
  --sidebar-w-collapsed: 48px;
}

/* Ajustar paneles que dependen de la altura de la topbar */
.right-drawer,
.details-panel {
  top: var(--topbar-h, 68px);
}

.left-sidebar {
  top: var(--topbar-h, 68px);
}

.pane {
  height: calc(100vh - var(--topbar-h, 68px));
}

/* ===== ANIMACIONES SUAVES ===== */
.topbar .toolbar {
  scroll-behavior: smooth;
}

.topbar .btn {
  transition: all 0.2s ease;
}

/* Estados de focus para accesibilidad */
.topbar .btn:focus {
  outline: 2px solid #60a5fa;
  outline-offset: 2px;
}


/* En móvil también mantener el fondo cuando ocupa todo el ancho */
@media (max-width: 1024px) {
  .refs-dropdown {
    background: #ffffff;
    border: 1px solid #e5e7eb;
    box-shadow: 0 -12px 30px rgba(0,0,0,.12);
  }
}

.report-result {
  background: #f8fafc;
  border-radius: 8px;
  padding: 12px;
  border: 1px solid #e2e8f0;
}

.report-result .kv {
  padding: 8px 0;
}


/* ===== Header: acciones a la derecha con gap ===== */
.details-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.details-actions-head {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

/* ===== Modo minimizado del panel de detalles ===== */
.details-panel.minimized {
  /* en desktop tipo "barra" baja; en móvil tipo "bottom sheet" chica */
  max-height: 74px;
  height: auto;
  overflow: hidden;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
}

.details-panel.minimized .details-body,
.details-panel.minimized .details-actions {
  display: none !important;   /* oculta contenido, deja solo el header */
}

/* Que el header siempre quede visible y se lea */
.details-header {
  position: sticky;
  top: 0;
  background: #fff;
  z-index: 2;
  padding: 12px 16px;
}

/* En móvil el alto del header un poquito mayor para tap-friendly */
@media (max-width: 1024px) {
  .details-panel.minimized {
    max-height: 64px;
  }
}

/* Evitar que la “manija” (si la tenés con ::before) tape los clicks */
.details-panel::before { pointer-events: none; }

/* ================================================================================================================================================================================
   RESPONSIVE / MOBILE FIXES
   ================================================================================================================================================================================ */
/* ========== FIXES APP BAR & DETAILS PANEL ========== */
@media (max-width: 1024px) {
  .refs-dropdown {
    right: 0;
    left: 0;
    max-width: none;
    border-radius: 0;
  }
}
/* 1) En móviles: que los botones de la TOPBAR NO ocupen 100% de ancho */
@media (max-width: 480px) {
  .topbar .btn,
  .topbar .dropdown > .btn,
  .topbar .refs-btn {
    width: auto !important;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 10px;   /* coherente con tus reglas */
    font-size: 13px;
    min-height: 36px;
    line-height: 1.1;
    white-space: nowrap;
    flex: 0 0 auto;
  }

  /* Evitar que el contenedor “estire” los botones */
.topbar .toolbar {
  display: flex;
  flex-wrap: nowrap;           /* <- evita que bajen a otra línea */
  overflow-x: auto;            /* <- permite desplazar horizontal */
  -webkit-overflow-scrolling: touch;
  gap: 6px;
  white-space: nowrap;         /* <- por si algún botón es inline */
}
.topbar {
  z-index: 2000;
}
.topbar .btn,
.topbar .dropdown > .btn,
.topbar .refs-btn {
  flex: 0 0 auto;              /* <- que no se estiren ni encojan */
}
}

/* 2) En tablets/móviles: asegurar layout correcto del header de paneles
      y que la X esté visible y clickeable */
.right-drawer header,
.details-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

/* Botón de cerrar siempre a la derecha, tamaño compacto */
.right-drawer header .btn-sm,
.details-header .btn-sm {
  flex: 0 0 auto;
  width: auto !important;
  min-width: 36px;
  min-height: 36px;
  padding: 6px 10px;
  font-size: 14px;
  line-height: 1;
}

/* 3) La “manija” del bottom-sheet no debe bloquear clicks */
.right-drawer::before,
.details-panel::before {
  pointer-events: none;     /* ← importante */
  z-index: 1;
}

/* Asegurar que el header quede por encima de la manija */
.right-drawer header,
.details-header {
  position: sticky;
  top: 0;
  z-index: 2;               /* por encima del ::before */
  background: #fff;
}

/* 4) Ajustes de tipografía para que la cabecera no “crezca” de más */
.details-header .big {
  font-size: 18px;
  line-height: 1.2;
  margin: 0;
}

/* 5) En móviles: no “estirar” botones fuera de paneles de contenido */
@media (max-width: 480px) {
  /* Tu regla original fuerza width:100% para .btn.
     La limitamos solo a botones dentro de paneles / formularios,
     NO a la topbar */
  .right-drawer .btn,
  .details-panel .btn {
    width: 100%;
  }
  /* Y explícitamente neutralizamos en la topbar */
  .topbar .btn {
    width: auto !important;
  }
}

/* 6) Por si algún user-agent aplica estilos raros al botón de cerrar (×) */
.btn.btn-sm {
  cursor: pointer;
}

/* 7) Evitar que el título se coma el espacio del botón cerrar en pantallas chicas */
.details-header > div:first-child {
  min-width: 0;
}
.details-header .big {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* 8) Alinear íconos/labels de los botones de la App Bar */
.topbar .btn,
.topbar .refs-btn {
  display: inline-flex;
  gap: 6px;
  align-items: center;
}
